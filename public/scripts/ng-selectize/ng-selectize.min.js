"use strict";angular.module("ng-selectize",["ng"]).directive("selectize",function(){return{restrict:"A",require:"ngModel",scope:{selectize:"&",options:"&"},link:function(a,b,c,d){function k(b){e||(a.$parent.$apply(function(){d.$setViewValue(b)}),"single"===f.mode&&g.blur())}function l(a){return angular.isArray(a)?a:a?String(a).split(f.delimiter):[]}function m(a,b){for(var c=0;c<a.length;c++)if(a[c]==b)return c;return-1}function n(a,b){return-1!==m(a,b)}function o(a,b){a.map(function(a){n(b,a)||n(h,a)||h.push(a)})}function p(a,b){var c,d;for(c=0;c<a.length;c++)d=m(h,a[c][g.settings.valueField]),-1!==d&&(b.push(a[c][g.settings.valueField]),h.splice(d,1))}function q(a){var b=l(a);e||b===l(g.getValue())||(e=!0,g.setValue(b),o(b,l(g.getValue())),e=!1)}function r(a){var b=l(d.$viewValue);"multi"===f.mode&&a&&p(a,b),g.addOption(a),g.refreshOptions(!1),q(b)}var e,f,g,h=[],i=a.options(),j=a.selectize();f=angular.extend({delimiter:",",persist:!0,mode:"SELECT"===b[0].tagName?b[0].hasAttribute("multiple")?"multi":"single":"multi"},j||{}),g=b.selectize(f)[0].selectize,g.on("change",function(){k(g.getValue())}),a.$parent.$watch(c.ngModel,q),c.options&&a.$parent.$watch(c.options,r,!0),a.$parent.$watch(i,r(i),!0),a.$on("$destroy",function(){g.destroy()})}}});